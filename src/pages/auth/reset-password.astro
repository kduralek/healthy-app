---
import Layout from '@/layouts/AuthLayout.astro';
import { UpdatePasswordForm } from '@/components/auth/UpdatePasswordForm';
import { createSupabaseServerClient } from '@/db/supabase.client';

// Check if the user is authenticated through the recovery flow
const supabase = createSupabaseServerClient({
  headers: Astro.request.headers,
  cookies: Astro.cookies,
});

const { data } = await supabase.auth.getSession();
const isAuthenticated = !!data.session;

// If not authenticated, redirect to login
if (!isAuthenticated) {
  return Astro.redirect('/auth/login');
}
---

<Layout title="Ustaw nowe hasÅ‚o">
  <UpdatePasswordForm client:load />
</Layout>
